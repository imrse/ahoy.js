/*! Ahoy.js v0.4.3 | MIT License */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ahoy=t()}(this,(function(){"use strict";var e={set:function(e,t,n){var i={value:t,expires:(new Date).getTime()+6e4*n};localStorage.setItem(e,JSON.stringify(i))},get:function(e){var t=localStorage.getItem(e);if(!t)return null;var n=JSON.parse(t);return(new Date).getTime()>n.expires?(localStorage.removeItem(e),null):n.value}},t={urlPrefix:"",visitsUrl:"/ahoy/visits",eventsUrl:"/ahoy/events",page:null,platform:"Web",useBeacon:!0,startOnReady:!0,trackVisits:!0,cookies:!0,cookieDomain:null,headers:{},visitParams:{},withCredentials:!1,visitDuration:240,visitorDuration:1051200},n=window.ahoy||window.Ahoy||{};n.configure=function(e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n.configure(n);var i,r,o,a,s=window.jQuery||window.Zepto||window.$,c=!1,u=[],l="undefined"!=typeof JSON&&void 0!==JSON.stringify,f=[];function d(){return t.urlPrefix+t.eventsUrl}function h(){return(t.useBeacon||t.trackNow)&&(e=t.headers,0===Object.keys(e).length)&&l&&void 0!==window.navigator.sendBeacon&&!t.withCredentials;var e}function v(n,i,r){e.set(n,i,r,t.cookieDomain||t.domain)}function p(t){return e.get(t)}function y(t){e.set(t,"",-1)}function g(e){p("ahoy_debug")&&window.console.log(e)}function m(){for(var e;e=u.shift();)e();c=!0}function w(e,t){var n=e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return n?n.apply(e,[t])?e:e.parentElement?w(e.parentElement,t):null:(g("Unable to match"),null)}function k(e,t,n){document.addEventListener(e,(function(e){var i=w(e.target,t);if(i){var r=D(i,"data-ahoy-skip");if(null!==r&&"false"!==r)return;n.call(i,e)}}))}function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function _(){t.cookies&&l&&v("ahoy_events",JSON.stringify(f),1)}function b(){var e=document.querySelector("meta[name=csrf-token]");return e&&e.content}function O(e){var t=b();t&&e.setRequestHeader("X-CSRF-Token",t)}function S(e,n,i){if(l)if(s&&s.ajax)s.ajax({type:"POST",url:e,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:O,success:i,headers:t.headers,xhrFields:{withCredentials:t.withCredentials}});else{var r=new XMLHttpRequest;for(var o in r.open("POST",e,!0),r.withCredentials=t.withCredentials,r.setRequestHeader("Content-Type","application/json"),t.headers)Object.prototype.hasOwnProperty.call(t.headers,o)&&r.setRequestHeader(o,t.headers[o]);r.onload=function(){200===r.status&&i()},O(r),r.send(JSON.stringify(n))}}function j(e){var n={events:[e]};return t.cookies&&(n.visit_token=e.visit_token,n.visitor_token=e.visitor_token),delete e.visit_token,delete e.visitor_token,n}function T(e){n.ready((function(){S(d(),j(e),(function(){for(var t=0;t<f.length;t++)if(f[t].id===e.id){f.splice(t,1);break}_()}))}))}function C(e){n.ready((function(){var t,n=j(e),i=(t=document.querySelector("meta[name=csrf-param]"))&&t.content,r=b();i&&r&&(n[i]=r),n.events_json=JSON.stringify(n.events),delete n.events,window.navigator.sendBeacon(d(),function(e){var t=new FormData;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.append(n,e[n]);return t}(n))}))}function P(){return t.page||window.location.pathname}function V(e){return e&&e.length>0?e:null}function N(){return function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&null===e[t]&&delete e[t];return e}({tag:this.tagName.toLowerCase(),id:V(this.id),class:V(this.className),page:P(),section:D(this,"data-section")})}function D(e,t){for(;e&&e!==document;e=e.parentNode)if(e.hasAttribute(t))return e.getAttribute(t);return null}function I(){if(c=!1,i=n.getVisitId(),r=n.getVisitorId(),o=p("ahoy_track"),!1===t.cookies||!1===t.trackVisits)g("Visit tracking disabled"),m();else if(i&&r&&!o)g("Active visit"),m();else if(i||v("ahoy_visit",i=x(),t.visitDuration),p("ahoy_visit")){g("Visit started"),r||v("ahoy_visitor",r=x(),t.visitorDuration);var e={visit_token:i,visitor_token:r,platform:t.platform,landing_page:window.location.href,screen_width:window.screen.width,screen_height:window.screen.height,js:!0};for(var a in document.referrer.length>0&&(e.referrer=document.referrer),t.visitParams)Object.prototype.hasOwnProperty.call(t.visitParams,a)&&(e[a]=t.visitParams[a]);g(e),S(t.urlPrefix+t.visitsUrl,e,(function(){y("ahoy_track"),m()}))}else g("Cookies disabled"),m()}n.ready=function(e){c?e():u.push(e)},n.getVisitId=n.getVisitToken=function(){return p("ahoy_visit")},n.getVisitorId=n.getVisitorToken=function(){return p("ahoy_visitor")},n.reset=function(){return y("ahoy_visit"),y("ahoy_visitor"),y("ahoy_events"),y("ahoy_track"),!0},n.resetVisitId=function(){return y("ahoy_visit"),!0},n.debug=function(e){return!1===e?y("ahoy_debug"):v("ahoy_debug","t",525600),!0},n.track=function(e,i){var r={name:e,properties:i||{},time:(new Date).getTime()/1e3,id:x(),js:!0};return n.ready((function(){t.cookies&&!n.getVisitId()&&I(),n.ready((function(){g(r),r.visit_token=n.getVisitId(),r.visitor_token=n.getVisitorId(),h()?C(r):(f.push(r),_(),setTimeout((function(){T(r)}),1e3))}))})),!0},n.trackView=function(e){var t={url:window.location.href,title:document.title,page:P()};if(e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);n.track("$view",t)},n.trackClicks=function(e){if(void 0===e)throw new Error("Missing selector");k("click",e,(function(e){var t=N.call(this,e);t.text="input"===t.tag?this.value:(this.textContent||this.innerText||this.innerHTML).replace(/[\s\r\n]+/g," ").trim(),t.href=this.href,n.track("$click",t)}))},n.trackSubmits=function(e){if(void 0===e)throw new Error("Missing selector");k("submit",e,(function(e){var t=N.call(this,e);n.track("$submit",t)}))},n.trackChanges=function(e){if(g("trackChanges is deprecated and will be removed in 0.5.0"),void 0===e)throw new Error("Missing selector");k("change",e,(function(e){var t=N.call(this,e);n.track("$change",t)}))};try{f=JSON.parse(p("ahoy_events")||"[]")}catch(e){}for(var M=0;M<f.length;M++)T(f[M]);return n.start=function(){I(),n.start=function(){}},a=function(){t.startOnReady&&n.start()},"interactive"===document.readyState||"complete"===document.readyState?setTimeout(a,0):document.addEventListener("DOMContentLoaded",a),n}));
